import enum


VERSION_NAMES = ['P1', 'E1', 'J1', 'P2', 'E2', 'J2', 'P3', 'J3', 'K', 'W', 'C']
VERSION_NAMES_NO_ESHOP = ['P1', 'E1', 'J1', 'P2', 'E2', 'J2', 'K', 'W', 'C']

REL_NAMES = [
    'd_profileNP',
    'd_basesNP',
    'd_enemiesNP',
    'd_en_bossNP',
]

CODE_FILE_NAMES = {
    'P1': 'main.dol',
    'E1': 'main.dol',
    'J1': 'main.dol',
    'P2': 'main.dol',
    'E2': 'main.dol',
    'J2': 'main.dol',
    'P3': 'main.dol',
    'J3': 'main.dol',
    'K': 'main.dol',
    'W': 'main.dol',
    'C': 'WIIMJ2DNP.alf',
}

SECTION_ADDRESSES = {
    'P1': {
        'main': {
            '.init': (0x80004000, 0x26c0),
            'extab': (0x800066c0, 0x60),
            'extabindex': (0x80006720, 0x60),
            '.text': (0x80006780, 0x2e7560),
            '.ctors': (0x802edce0, 0x2e0),
            '.dtors': (0x802edfc0, 0x20),
            '.rodata': (0x802edfe0, 0x106c0),
            '.data': (0x802fe6a0, 0x532e0),
            '.bss': (0x80351980, 0xd6000),
            '.sdata': (0x80427980, 0x2520),
            '.sbss': (0x80429ea0, 0x14c0),
            '.sdata2': (0x8042b360, 0x4b60),
            '.sbss2': (0x8042fec0, 0x5c),
        },
        'd_profileNP': {
            '.text': (0x807685a0, 0x1fb8),
            '.ctors': (0x8076a558, 0x8),
            '.dtors': (0x8076a560, 0xc),
            '.data': (0x8076a570, 0x1d8),
            '.rodata': (0x8076a748, 0x15fc),
            '.bss': (0x8076d460, 0x208),
        },
        'd_basesNP': {
            '.text': (0x8076d770, 0x1c6004),
            '.ctors': (0x80933774, 0x4fc),
            '.dtors': (0x80933c70, 0xc),
            '.data': (0x80933c80, 0xa5fc),
            '.rodata': (0x8093e280, 0x51c98),
            '.bss': (0x80990800, 0x12484),
        },
        'd_enemiesNP': {
            '.text': (0x809a2d90, 0x12a428),
            '.ctors': (0x80acd1b8, 0x28c),
            '.dtors': (0x80acd444, 0xc),
            '.data': (0x80acd450, 0x8610),
            '.rodata': (0x80ad5a60, 0x3b678),
            '.bss': (0x80b11420, 0xb4e0),
        },
        'd_en_bossNP': {
            '.text': (0x80b1ca10, 0x5702c),
            '.ctors': (0x80b73a3c, 0x6c),
            '.dtors': (0x80b73aa8, 0xc),
            '.data': (0x80b73ab8, 0x21f0),
            '.rodata': (0x80b75ca8, 0x13520),
            '.bss': (0x80b89aa0, 0x487c),
        },
    },
    'E1': {
        'main': {
            '.init': (0x80004000, 0x26c0),
            'extab': (0x800066c0, 0x60),
            'extabindex': (0x80006720, 0x60),
            '.text': (0x80006780, 0x2e7260),
            '.ctors': (0x802ed9e0, 0x2e0),
            '.dtors': (0x802edcc0, 0x20),
            '.rodata': (0x802edce0, 0x106c0),
            '.data': (0x802fe3a0, 0x532a0),
            '.bss': (0x80351680, 0xd6000),
            '.sdata': (0x80427680, 0x2540),
            '.sbss': (0x80429bc0, 0x14c0),
            '.sdata2': (0x8042b080, 0x4b60),
            '.sbss2': (0x8042fbe0, 0x5c),
        },
        'd_profileNP': {
            '.text': (0x807685a0, 0x1fb8),
            '.ctors': (0x8076a558, 0x8),
            '.dtors': (0x8076a560, 0xc),
            '.data': (0x8076a570, 0x1d8),
            '.rodata': (0x8076a748, 0x15fc),
            '.bss': (0x8076d460, 0x208),
        },
        'd_basesNP': {
            '.text': (0x8076d770, 0x1c6004),
            '.ctors': (0x80933774, 0x4fc),
            '.dtors': (0x80933c70, 0xc),
            '.data': (0x80933c80, 0xa5fc),
            '.rodata': (0x8093e280, 0x51cb8),
            '.bss': (0x80990820, 0x12484),
        },
        'd_enemiesNP': {
            '.text': (0x809a2db0, 0x12a428),
            '.ctors': (0x80acd1d8, 0x28c),
            '.dtors': (0x80acd464, 0xc),
            '.data': (0x80acd470, 0x8610),
            '.rodata': (0x80ad5a80, 0x3b678),
            '.bss': (0x80b11440, 0xb4e0),
        },
        'd_en_bossNP': {
            '.text': (0x80b1ca30, 0x5702c),
            '.ctors': (0x80b73a5c, 0x6c),
            '.dtors': (0x80b73ac8, 0xc),
            '.data': (0x80b73ad8, 0x21f0),
            '.rodata': (0x80b75cc8, 0x13520),
            '.bss': (0x80b89ac0, 0x487c),
        },
    },
    'J1': {
        'main': {
            '.init': (0x80004000, 0x26c0),
            'extab': (0x800066c0, 0x60),
            'extabindex': (0x80006720, 0x60),
            '.text': (0x80006780, 0x2e7080),
            '.ctors': (0x802ed800, 0x2e0),
            '.dtors': (0x802edae0, 0x20),
            '.rodata': (0x802edb00, 0x106c0),
            '.data': (0x802fe1c0, 0x531e0),
            '.bss': (0x80351400, 0xd6000),
            '.sdata': (0x80427400, 0x24e0),
            '.sbss': (0x804298e0, 0x14c0),
            '.sdata2': (0x8042ada0, 0x4b60),
            '.sbss2': (0x8042f900, 0x5c),
        },
        'd_profileNP': {
            '.text': (0x807685a0, 0x1fb8),
            '.ctors': (0x8076a558, 0x8),
            '.dtors': (0x8076a560, 0xc),
            '.data': (0x8076a570, 0x1d8),
            '.rodata': (0x8076a748, 0x15fc),
            '.bss': (0x8076d460, 0x208),
        },
        'd_basesNP': {
            '.text': (0x8076d770, 0x1c5d44),
            '.ctors': (0x809334b4, 0x4fc),
            '.dtors': (0x809339b0, 0xc),
            '.data': (0x809339c0, 0xa5fc),
            '.rodata': (0x8093dfc0, 0x51860),
            '.bss': (0x80990100, 0x12484),
        },
        'd_enemiesNP': {
            '.text': (0x809a2690, 0x12a428),
            '.ctors': (0x80accab8, 0x28c),
            '.dtors': (0x80accd44, 0xc),
            '.data': (0x80accd50, 0x8610),
            '.rodata': (0x80ad5360, 0x3b678),
            '.bss': (0x80b10d20, 0xb4e0),
        },
        'd_en_bossNP': {
            '.text': (0x80b1c310, 0x5702c),
            '.ctors': (0x80b7333c, 0x6c),
            '.dtors': (0x80b733a8, 0xc),
            '.data': (0x80b733b8, 0x21f0),
            '.rodata': (0x80b755a8, 0x13520),
            '.bss': (0x80b893a0, 0x487c),
        },
    },
    'P2': {
        'main': {
            '.init': (0x80004000, 0x26c0),
            'extab': (0x800066c0, 0x60),
            'extabindex': (0x80006720, 0x60),
            '.text': (0x80006780, 0x2e7560),
            '.ctors': (0x802edce0, 0x2e0),
            '.dtors': (0x802edfc0, 0x20),
            '.rodata': (0x802edfe0, 0x106c0),
            '.data': (0x802fe6a0, 0x532e0),
            '.bss': (0x80351980, 0xd6000),
            '.sdata': (0x80427980, 0x2520),
            '.sbss': (0x80429ea0, 0x14c0),
            '.sdata2': (0x8042b360, 0x4b60),
            '.sbss2': (0x8042fec0, 0x5c),
        },
        'd_profileNP': {
            '.text': (0x807685e0, 0x1fb8),
            '.ctors': (0x8076a598, 0x8),
            '.dtors': (0x8076a5a0, 0xc),
            '.data': (0x8076a5b0, 0x1d8),
            '.rodata': (0x8076a788, 0x15fc),
            '.bss': (0x8076d4a0, 0x208),
        },
        'd_basesNP': {
            '.text': (0x8076d7b0, 0x1c5fd4),
            '.ctors': (0x80933784, 0x4fc),
            '.dtors': (0x80933c80, 0xc),
            '.data': (0x80933c90, 0xa5fc),
            '.rodata': (0x8093e290, 0x51c98),
            '.bss': (0x80990820, 0x12484),
        },
        'd_enemiesNP': {
            '.text': (0x809a2db0, 0x12a428),
            '.ctors': (0x80acd1d8, 0x28c),
            '.dtors': (0x80acd464, 0xc),
            '.data': (0x80acd470, 0x8610),
            '.rodata': (0x80ad5a80, 0x3b678),
            '.bss': (0x80b11440, 0xb4e0),
        },
        'd_en_bossNP': {
            '.text': (0x80b1ca30, 0x5702c),
            '.ctors': (0x80b73a5c, 0x6c),
            '.dtors': (0x80b73ac8, 0xc),
            '.data': (0x80b73ad8, 0x21f0),
            '.rodata': (0x80b75cc8, 0x13520),
            '.bss': (0x80b89ac0, 0x487c),
        },
    },
    'E2': {
        'main': {
            '.init': (0x80004000, 0x26c0),
            'extab': (0x800066c0, 0x60),
            'extabindex': (0x80006720, 0x60),
            '.text': (0x80006780, 0x2e7260),
            '.ctors': (0x802ed9e0, 0x2e0),
            '.dtors': (0x802edcc0, 0x20),
            '.rodata': (0x802edce0, 0x106c0),
            '.data': (0x802fe3a0, 0x532a0),
            '.bss': (0x80351680, 0xd6000),
            '.sdata': (0x80427680, 0x2540),
            '.sbss': (0x80429bc0, 0x14c0),
            '.sdata2': (0x8042b080, 0x4b60),
            '.sbss2': (0x8042fbe0, 0x5c),
        },
        'd_profileNP': {
            '.text': (0x807685e0, 0x1fb8),
            '.ctors': (0x8076a598, 0x8),
            '.dtors': (0x8076a5a0, 0xc),
            '.data': (0x8076a5b0, 0x1d8),
            '.rodata': (0x8076a788, 0x15fc),
            '.bss': (0x8076d4a0, 0x208),
        },
        'd_basesNP': {
            '.text': (0x8076d7b0, 0x1c5fd4),
            '.ctors': (0x80933784, 0x4fc),
            '.dtors': (0x80933c80, 0xc),
            '.data': (0x80933c90, 0xa5fc),
            '.rodata': (0x8093e290, 0x51cb8),
            '.bss': (0x80990840, 0x12484),
        },
        'd_enemiesNP': {
            '.text': (0x809a2dd0, 0x12a428),
            '.ctors': (0x80acd1f8, 0x28c),
            '.dtors': (0x80acd484, 0xc),
            '.data': (0x80acd490, 0x8610),
            '.rodata': (0x80ad5aa0, 0x3b678),
            '.bss': (0x80b11460, 0xb4e0),
        },
        'd_en_bossNP': {
            '.text': (0x80b1ca50, 0x5702c),
            '.ctors': (0x80b73a7c, 0x6c),
            '.dtors': (0x80b73ae8, 0xc),
            '.data': (0x80b73af8, 0x21f0),
            '.rodata': (0x80b75ce8, 0x13520),
            '.bss': (0x80b89ae0, 0x487c),
        },
    },
    'J2': {
        'main': {
            '.init': (0x80004000, 0x26c0),
            'extab': (0x800066c0, 0x60),
            'extabindex': (0x80006720, 0x60),
            '.text': (0x80006780, 0x2e7080),
            '.ctors': (0x802ed800, 0x2e0),
            '.dtors': (0x802edae0, 0x20),
            '.rodata': (0x802edb00, 0x106c0),
            '.data': (0x802fe1c0, 0x531e0),
            '.bss': (0x80351400, 0xd6000),
            '.sdata': (0x80427400, 0x24e0),
            '.sbss': (0x804298e0, 0x14c0),
            '.sdata2': (0x8042ada0, 0x4b60),
            '.sbss2': (0x8042f900, 0x5c),
        },
        'd_profileNP': {
            '.text': (0x807685e0, 0x1fb8),
            '.ctors': (0x8076a598, 0x8),
            '.dtors': (0x8076a5a0, 0xc),
            '.data': (0x8076a5b0, 0x1d8),
            '.rodata': (0x8076a788, 0x15fc),
            '.bss': (0x8076d4a0, 0x208),
        },
        'd_basesNP': {
            '.text': (0x8076d7b0, 0x1c5d14),
            '.ctors': (0x809334c4, 0x4fc),
            '.dtors': (0x809339c0, 0xc),
            '.data': (0x809339d0, 0xa5fc),
            '.rodata': (0x8093dfd0, 0x51860),
            '.bss': (0x80990120, 0x12484),
        },
        'd_enemiesNP': {
            '.text': (0x809a26b0, 0x12a428),
            '.ctors': (0x80accad8, 0x28c),
            '.dtors': (0x80accd64, 0xc),
            '.data': (0x80accd70, 0x8610),
            '.rodata': (0x80ad5380, 0x3b678),
            '.bss': (0x80b10d40, 0xb4e0),
        },
        'd_en_bossNP': {
            '.text': (0x80b1c330, 0x5702c),
            '.ctors': (0x80b7335c, 0x6c),
            '.dtors': (0x80b733c8, 0xc),
            '.data': (0x80b733d8, 0x21f0),
            '.rodata': (0x80b755c8, 0x13520),
            '.bss': (0x80b893c0, 0x487c),
        },
    },
    'K': {
        'main': {
            '.init': (0x80004000, 0x26c0),
            'extab': (0x800066c0, 0x60),
            'extabindex': (0x80006720, 0x60),
            '.text': (0x80006780, 0x2e78a0),
            '.ctors': (0x802ee020, 0x2e0),
            '.dtors': (0x802ee300, 0x20),
            '.rodata': (0x802ee320, 0x1c8c0),
            '.data': (0x8030abe0, 0x53780),
            '.bss': (0x8035e380, 0xd6000),
            '.sdata': (0x80434380, 0x24e0),
            '.sbss': (0x80436860, 0x14c0),
            '.sdata2': (0x80437d20, 0x4b60),
            '.sbss2': (0x8043c880, 0x5c),
        },
        'd_profileNP': {
            '.text': (0x807685a0, 0x1fb8),
            '.ctors': (0x8076a558, 0x8),
            '.dtors': (0x8076a560, 0xc),
            '.data': (0x8076a570, 0x1d8),
            '.rodata': (0x8076a748, 0x1604),
            '.bss': (0x8076d460, 0x208),
        },
        'd_basesNP': {
            '.text': (0x8076d770, 0x1ca1e4),
            '.ctors': (0x80937954, 0x504),
            '.dtors': (0x80937e58, 0xc),
            '.data': (0x80937e68, 0xa724),
            '.rodata': (0x80942590, 0x52968),
            '.bss': (0x809957e0, 0x129a4),
        },
        'd_enemiesNP': {
            '.text': (0x809a8290, 0x12a4f8),
            '.ctors': (0x80ad2788, 0x28c),
            '.dtors': (0x80ad2a14, 0xc),
            '.data': (0x80ad2a20, 0x8610),
            '.rodata': (0x80adb030, 0x3b678),
            '.bss': (0x80b16a00, 0xb4e0),
        },
        'd_en_bossNP': {
            '.text': (0x80b21ff0, 0x5703c),
            '.ctors': (0x80b7902c, 0x6c),
            '.dtors': (0x80b79098, 0xc),
            '.data': (0x80b790a8, 0x21f0),
            '.rodata': (0x80b7b298, 0x13520),
            '.bss': (0x80b8f080, 0x487c),
        },
    },
    'W': {
        'main': {
            '.init': (0x80004000, 0x26c0),
            'extab': (0x800066c0, 0x60),
            'extabindex': (0x80006720, 0x60),
            '.text': (0x80006780, 0x2e78a0),
            '.ctors': (0x802ee020, 0x2e0),
            '.dtors': (0x802ee300, 0x20),
            '.rodata': (0x802ee320, 0x1ac80),
            '.data': (0x80308fa0, 0x53780),
            '.bss': (0x8035c780, 0xd6000),
            '.sdata': (0x80432780, 0x24e0),
            '.sbss': (0x80434c60, 0x14c0),
            '.sdata2': (0x80436120, 0x4b60),
            '.sbss2': (0x8043ac80, 0x5c),
        },
        'd_profileNP': {
            '.text': (0x807685a0, 0x1fb8),
            '.ctors': (0x8076a558, 0x8),
            '.dtors': (0x8076a560, 0xc),
            '.data': (0x8076a570, 0x1d8),
            '.rodata': (0x8076a748, 0x1604),
            '.bss': (0x8076d460, 0x208),
        },
        'd_basesNP': {
            '.text': (0x8076d770, 0x1ca194),
            '.ctors': (0x80937904, 0x504),
            '.dtors': (0x80937e08, 0xc),
            '.data': (0x80937e18, 0xa724),
            '.rodata': (0x80942540, 0x52928),
            '.bss': (0x80995760, 0x129a4),
        },
        'd_enemiesNP': {
            '.text': (0x809a8210, 0x12a4f8),
            '.ctors': (0x80ad2708, 0x28c),
            '.dtors': (0x80ad2994, 0xc),
            '.data': (0x80ad29a0, 0x8610),
            '.rodata': (0x80adafb0, 0x3b678),
            '.bss': (0x80b16980, 0xb4e0),
        },
        'd_en_bossNP': {
            '.text': (0x80b21f70, 0x5703c),
            '.ctors': (0x80b78fac, 0x6c),
            '.dtors': (0x80b79018, 0xc),
            '.data': (0x80b79028, 0x21f0),
            '.rodata': (0x80b7b218, 0x13520),
            '.bss': (0x80b8f000, 0x487c),
        },
    },
    'C': {
        'main': {
            '.init': (0x80004000, 0x26bc),
            'extab': (0x800066c0, 0x48),
            'extabindex': (0x80006720, 0x5c),
            '.text': (0x80006780, 0x2ebcec),
            '.ctors': (0x802f2480, 0x2d8),
            '.dtors': (0x802f2760, 0xc),
            '.rodata': (0x802f2780, 0x10760),
            '.data': (0x80302ee0, 0x53d20),
            '.bss': (0x80356c00, 0xd62f0),
            '.sdata': (0x8042cf00, 0x2508),
            '.sbss': (0x8042f420, 0x14c4),
            '.sdata2': (0x80430900, 0x4bb4),
            '.sbss2': (0x804354c0, 0x54),
        },
        # NOTE: REL addrs are based on the Dolphin port -- not verified in Lingcod yet
        'd_profileNP': {
            '.text': (0x807685a0, 0x1fb8),
            '.ctors': (0x8076a558, 0x8),
            '.dtors': (0x8076a560, 0xc),
            '.data': (0x8076a570, 0x1d8),
            '.rodata': (0x8076a748, 0x160c),
            '.bss': (0x8076d480, 0x208),
        },
        'd_basesNP': {
            '.text': (0x8076d790, 0x1ca994),
            '.ctors': (0x80938124, 0x504),
            '.dtors': (0x80938628, 0xc),
            '.data': (0x80938638, 0xa724),
            '.rodata': (0x80942d60, 0x529a8),
            '.bss': (0x80996000, 0x129ac),
        },
        'd_enemiesNP': {
            '.text': (0x809a8ab0, 0x12a498),
            '.ctors': (0x80ad2f48, 0x28c),
            '.dtors': (0x80ad31d4, 0xc),
            '.data': (0x80ad31e0, 0x85e8),
            '.rodata': (0x80adb7c8, 0x3b6b0),
            '.bss': (0x80b171c0, 0xb4e8),
        },
        'd_en_bossNP': {
            '.text': (0x80b227b0, 0x5703c),
            '.ctors': (0x80b797ec, 0x6c),
            '.dtors': (0x80b79858, 0xc),
            '.data': (0x80b79868, 0x21f0),
            '.rodata': (0x80b7ba58, 0x13520),
            '.bss': (0x80b8f840, 0x487c),
        },
    },
}
SECTION_ADDRESSES['P3'] = SECTION_ADDRESSES['P2']
SECTION_ADDRESSES['J3'] = SECTION_ADDRESSES['J2']

R2_R13_VALUES = {
    'P1': (0x80433360, 0x8042f980),
    'E1': (0x80433080, 0x8042f680),
    'J1': (0x80432da0, 0x8042f400),
    'P2': (0x80433360, 0x8042f980),
    'E2': (0x80433080, 0x8042f680),
    'J2': (0x80432da0, 0x8042f400),
    'P3': (0x80433360, 0x8042f980),
    'J3': (0x80432da0, 0x8042f400),
    'K': (0x8043fd20, 0x8043c380),
    'W': (0x8043e120, 0x8043a780),
    'C': (0x80438900, 0x80434f00),
}

class Permissions(enum.Flag):
    R = enum.auto()
    W = enum.auto()
    X = enum.auto()

    @classmethod
    def none(cls) -> 'Permissions':
        return cls.R & cls.W

# In order of increasing start address
DOL_SECTION_NAMES = [
    '.init',
    'extab',
    'extabindex',
    '.text',
    '.ctors',
    '.dtors',
    '.rodata',
    '.data',
    '.bss',
    '.sdata',
    '.sbss',
    '.sdata2',
    '.sbss2',
]
DOL_SECTION_INFO = {
    '.init':      {'class': 'CODE', 'permissions': Permissions.R | Permissions.X},
    'extab':      {'class': 'DATA', 'permissions': Permissions.R | Permissions.W},
    'extabindex': {'class': 'DATA', 'permissions': Permissions.R | Permissions.W},
    '.text':      {'class': 'CODE', 'permissions': Permissions.R | Permissions.X},
    '.ctors':     {'class': 'DATA', 'permissions': Permissions.R},
    '.dtors':     {'class': 'DATA', 'permissions': Permissions.R},
    '.rodata':    {'class': 'DATA', 'permissions': Permissions.R},
    '.data':      {'class': 'DATA', 'permissions': Permissions.R | Permissions.W},
    '.bss':       {'class': 'BSS',  'permissions': Permissions.R | Permissions.W},
    '.sdata':     {'class': 'DATA', 'permissions': Permissions.R | Permissions.W},
    '.sbss':      {'class': 'BSS',  'permissions': Permissions.R | Permissions.W},
    '.sdata2':    {'class': 'DATA', 'permissions': Permissions.R | Permissions.W},
    '.sbss2':     {'class': 'BSS',  'permissions': Permissions.R | Permissions.W},
}

REL_SECTION_NAMES = [
    '.text',
    '.ctors',
    '.dtors',
    '.data',
    '.rodata',
    '.bss',
]
REL_SECTION_INFO = {
    '.text':   {'class': 'CODE', 'permissions': Permissions.R | Permissions.X},
    '.ctors':  {'class': 'DATA', 'permissions': Permissions.R},
    '.dtors':  {'class': 'DATA', 'permissions': Permissions.R},
    '.data':   {'class': 'DATA', 'permissions': Permissions.R | Permissions.W},
    '.rodata': {'class': 'DATA', 'permissions': Permissions.R},
    '.bss':    {'class': 'BSS',  'permissions': Permissions.R | Permissions.W},
}
